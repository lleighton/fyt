var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: !0 });
}, __copyProps = (to, from, except, desc) => {
  if (from && typeof from == "object" || typeof from == "function")
    for (let key of __getOwnPropNames(from))
      !__hasOwnProp.call(to, key) && key !== except && __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: !0 }), mod);
var checkDeps_exports = {};
__export(checkDeps_exports, {
  DEPENDENCY_TYPE: () => DEPENDENCY_TYPE,
  checkDeps: () => checkDeps
});
module.exports = __toCommonJS(checkDeps_exports);
var import_node_fs = require("node:fs"), import_node_path = require("node:path"), import_check_dep_versions = require("./check-dep-versions"), DEPENDENCY_TYPE = /* @__PURE__ */ ((DEPENDENCY_TYPE2) => (DEPENDENCY_TYPE2.dependencies = "dependencies", DEPENDENCY_TYPE2.devDependencies = "devDependencies", DEPENDENCY_TYPE2.optionalDependencies = "optionalDependencies", DEPENDENCY_TYPE2.peerDependencies = "peerDependencies", DEPENDENCY_TYPE2.resolutions = "resolutions", DEPENDENCY_TYPE2))(DEPENDENCY_TYPE || {});
function checkTamaguiPackageVersions(root) {
  const packageJsonPath = (0, import_node_path.join)(root, "package.json");
  if (!(0, import_node_fs.existsSync)(packageJsonPath))
    return "";
  const packageJson = JSON.parse((0, import_node_fs.readFileSync)(packageJsonPath, "utf8")), tamaguiDeps = [], allDeps = {
    ...packageJson.dependencies,
    ...packageJson.devDependencies,
    ...packageJson.optionalDependencies
  };
  for (const [name, version] of Object.entries(allDeps))
    (name === "tamagui" || name.startsWith("@tamagui/")) && tamaguiDeps.push({ name, version });
  if (tamaguiDeps.length <= 1)
    return "";
  const normalizeVersion = (v) => v.startsWith("workspace:") ? v : v.replace(/^[\^~>=<]+/, ""), versionGroups = /* @__PURE__ */ new Map();
  for (const dep of tamaguiDeps) {
    const normalized = normalizeVersion(dep.version);
    versionGroups.has(normalized) || versionGroups.set(normalized, []), versionGroups.get(normalized).push(`${dep.name}@${dep.version}`);
  }
  if (versionGroups.size <= 1)
    return "";
  const lines = [
    "Found mismatched @tamagui/* package versions in package.json:",
    ""
  ];
  for (const [version, packages] of versionGroups) {
    lines.push(`  ${version}:`);
    for (const pkg of packages.sort())
      lines.push(`    - ${pkg}`);
  }
  return lines.push(""), lines.push(
    "All @tamagui/* packages should use the same version to avoid runtime issues."
  ), lines.push("Run `npx tamagui upgrade` to sync all packages to the latest version."), lines.join(`
`);
}
async function checkDeps(root) {
  const tamaguiMismatchSummary = checkTamaguiPackageVersions(root), workspaceMismatchSummary = new import_check_dep_versions.CDVC(root).toMismatchSummary(), hasTamaguiMismatch = !!tamaguiMismatchSummary, hasWorkspaceMismatch = !!workspaceMismatchSummary;
  !hasTamaguiMismatch && !hasWorkspaceMismatch && (console.info("Tamagui dependencies look good \u2705"), process.exit(0)), hasTamaguiMismatch && console.error(tamaguiMismatchSummary), hasWorkspaceMismatch && (hasTamaguiMismatch && console.error(""), console.error(workspaceMismatchSummary)), process.exit(1);
}
//# sourceMappingURL=checkDeps.js.map
